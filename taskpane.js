!function(e){var o={};function t(s){if(o[s])return o[s].exports;var n=o[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=e,t.c=o,t.d=function(e,o,s){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var n in e)t.d(s,n,function(o){return e[o]}.bind(null,n));return s},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=307)}({307:function(e,o){Office.onReady((function(e){e.host===Office.HostType.Outlook&&(t.msalInit(),t.defaultEmail=Office.context.roamingSettings.get("default_email"),document.getElementById("sideload-msg").style.display="none",document.getElementById("app-body").style.display="flex",document.getElementById("userAuthBtn").onclick=t.msalUserLogin,document.getElementById("sendEmail").onclick=t.getMailMime,document.getElementById("saveDefault").onclick=t.setDefaultEmail,t.defaultEmail&&$("#toEmail").val(t.defaultEmail))}));var t={msalInstance:{},msAccessToken:"",isUserLoggedIn:!1,defaultEmail:"",msalConfig:{auth:{clientId:"91390636-1b1c-4c9e-ae4d-d91f2cde8aa6",authority:"https://login.microsoftonline.com/common",redirectUri:"https://localhost:3000/taskpane.html",postLogoutRedirectUri:"https://localhost:3000/taskpane.html"},cache:{cacheLocation:"sessionStorage"}},graphConfig:{endPoint:"https://graph.microsoft.com/v1.0/me"},permissionScope:{scopes:["https://graph.microsoft.com/mail.read","https://graph.microsoft.com/user.read","https://graph.microsoft.com/mail.send"]},msalInit:function(){$(".progressLoader").show(),t.msalInstance=new Msal.UserAgentApplication(t.msalConfig),t.msalInstance.acquireTokenSilent(t.permissionScope).then(t.silentTokenSuccess,t.silentTokenError)},msalUserLogin:function(){$(".progressLoader").show(),t.msalInstance.loginPopup(t.permissionScope).then((function(e){t.msalInstance.acquireTokenSilent(t.permissionScope).then((function(e){console.log(e.accessToken),t.msAccessToken=e.accessToken,$(".progressLoader").hide(),$("#afterLogin").show(),$("#beforeLogin").hide()}))}))},silentTokenSuccess:function(e){console.log("User Already Logged In!"),console.log(e.accessToken),t.msAccessToken=e.accessToken,$("#beforeLogin").hide(),$("#afterLogin").show(),$(".progressLoader").hide()},silentTokenError:function(e){e.toString().indexOf(!0)&&t.msalInstance.acquireTokenPopup(t.permissionScope).then((function(e){console.log("Success acquiring access token"),t.msAccessToken=e,$("#afterLogin").show(),$("#beforeLogin").hide(),$(".progressLoader").hide()}),(function(e){console.log("Failure acquiring token: "+e),$("#beforeLogin").show(),$("#afterLogin").hide(),$(".progressLoader").hide()}))},settingDialog:function(){Office.context.ui.displayDialogAsync("https://localhost:3000/settings.html",{width:20,height:40,displayInIframe:!0},(function(e){settingsDialog=e.value,settingsDialog.addEventHandler(Microsoft.Office.WebExtension.EventType.DialogMessageReceived,receiveMessage),settingsDialog.addEventHandler(Microsoft.Office.WebExtension.EventType.DialogEventReceived,dialogClosed)}))},setDefaultEmail:function(){var e=$("#toEmail").val();if(e){var o=Office.context.roamingSettings;o.set("default_email",e),o.saveAsync(t.saveSoarSettingsCallback)}else t.showErrorMsg("Please enter email !")},saveSoarSettingsCallback:function(e){if(e.status==Office.AsyncResultStatus.Failed)t.showErrorMsg("Unable to save as default email !");else{var o=$("#toEmail").val();t.showSuccessMsg(o+" saved as default email !")}},sendEmail:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";$.ajax({crossDomain:!0,url:t.graphConfig.endPoint+"/sendMail",method:"POST",data:e,headers:{Authorization:"Bearer "+t.msAccessToken,"content-type":"application/json"}}).done((function(e,o,s){t.showSuccessMsg("Email sent successfully !")})).fail((function(e,o,s){console.log(e),t.showErrorMsg("Unable to send email!")}))},getMailMime:function(){if($("#toEmail").val()){$(".progressLoader").show();var e=Office.context.mailbox.item,o=Office.context.mailbox.convertToRestId(e.itemId,Office.MailboxEnums.RestVersion.v2_0);$.ajax({crossDomain:!0,url:t.graphConfig.endPoint+"/messages/"+o+"/$value",method:"GET",headers:{Authorization:"Bearer "+t.msAccessToken,"content-type":"application/json"}}).done((function(e,o,s){if("success"==o){var n=t.buildMessage(e);t.sendEmail(n)}})).fail((function(e,o,s){console.log(e),t.showErrorMsg("Unable to read the email !")}))}else t.showErrorMsg("Please enter email !")},buildMessage:function(e){var o=$("#toEmail").val(),t=btoa(e),s=Office.context.mailbox.item;return JSON.stringify({message:{subject:"Outlook Add-in Final Test",body:{contentType:"HTML",content:"<p>Hello Yair</p> This email was sent from outlook add-in. Please test the content of attached eml file. The final flow of the Add-in is ready to be reviewed.<p>Regards,<br/>Vivek Negi</p>"},toRecipients:[{emailAddress:{address:o}}],attachments:[{"@odata.type":"#microsoft.graph.fileAttachment",name:s.subject+".eml",contentType:"application/octet-stream",contentBytes:t}]},saveToSentItems:"true"})},showSuccessMsg:function(e){$(".progressLoader").hide(),$("#errMsgBar").hide(),$(".ms-MessageBar-text").text(e),$("#successMsgBar").show()},showErrorMsg:function(e){$(".progressLoader").hide(),$(".ms-MessageBar-text").text(e),$("#successMsgBar").hide(),$("#errMsgBar").show()},logOut:function(){t.msalInstance.logout(),$("#beforeLogin").show(),$("#afterLogin").hide()}}}});
//# sourceMappingURL=taskpane.js.map